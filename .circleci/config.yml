version: 2.1

workflows:
  csc-workflow:
    jobs:
      - csc-release:
          context: cscrelease

jobs:
  csc-release:
    docker:
      - image: centos:7
    steps:
      - checkout
      - run:
          yum install epel-release -y
          yum -y install https://packages.endpoint.com/rhel/7/os/x86_64/endpoint-repo-1.7-1.x86_64.rpm -y
      - run: yum install git -y
      - run: yum install dnf -y
      - run:
          dnf install 'dnf-command(config-manager)' -y
          dnf config-manager --add-repo https://cli.github.com/packages/rpm/gh-cli.repo
      - run: dnf install gh -y
      - run: dnf update gh -y
      - run: 
          git clone --depth 1 --filter=blob:none --sparse https://github.com/vladbielov/csc-release ;
          cd csc-release
          git sparse-checkout set changelog
          echo ${CSC_TOKEN} > csc.txt
          gh auth login --with-token < csc.txt
      #- run: gh release -R vladbielov/csc-release create v1.0.1 changelog/CHANGELOG.md --title "New Title" --notes "New Note"  
