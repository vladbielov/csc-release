version: 2.1

workflows:
  csc-workflow:
    jobs:
      - csc-release:
          context: cscrelease

jobs:
  csc-release:
    docker:
      - image: centos:7
    steps:
      - checkout
      - run: yum install epel-release -y
      - run: yum -y install https://packages.endpoint.com/rhel/7/os/x86_64/endpoint-repo-1.7-1.x86_64.rpm -y
      - run: yum install git -y
      - run: yum install dnf -y
      - run: dnf install 'dnf-command(config-manager)' -y
      - run: dnf config-manager --add-repo https://cli.github.com/packages/rpm/gh-cli.repo
      - run: dnf install gh -y
      - run: dnf update gh -y
      - run: git --version
      - run: git clone --depth 1 --filter=blob:none --sparse https://github.com/vladbielov/csc-release ;
      - run: cd csc-release
      - run: git sparse-checkout set changelog
      - run: echo ${CSC_TOKEN} > csc.txt
      - run: gh auth login --with-token < csc.txt
      #- run: gh release -R vladbielov/csc-release create v1.0.1 --title  New --notes New  